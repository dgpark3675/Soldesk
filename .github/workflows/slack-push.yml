name: Slack Commit Notification

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      # 루트 메시지 보내기
      - name: Send root message to Slack
        id: slack-root
        run: |
          RESPONSE=$(curl -s -X POST -H 'Content-type: application/json' \
            --data '{"text":"🚀 New push to *${{ github.repository }}* by *${{ github.actor }}*"}' \
            ${{ secrets.SLACK_WEBHOOK_URL }})
          # 루트 메시지 timestamp 추출
          echo "ts=$(echo $RESPONSE | jq -r .ts)" >> $GITHUB_OUTPUT

      # 스레드에 커밋 메시지 보내기
      - name: Send commit details in thread
        run: |
          curl -X POST -H 'Content-type: application/json' \
          --data '{
            "text": "Commit: ${{ github.event.head_commit.message }}\nURL: ${{ github.event.head_commit.url }}",
            "thread_ts": "${{ steps.slack-root.outputs.ts }}"
          }' \
          ${{ secrets.SLACK_WEBHOOK_URL }}
