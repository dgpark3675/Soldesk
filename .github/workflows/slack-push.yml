name: Slack Commit Notification

on:
  push:
    branches:
      - main

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      # ë£¨íŠ¸ ë©”ì‹œì§€ ë³´ë‚´ê¸°
      - name: Send root message to Slack
        id: slack-root
        run: |
          RESPONSE=$(curl -s -X POST -H 'Content-type: application/json' \
            --data '{"text":"ğŸš€ New push to *${{ github.repository }}* by *${{ github.actor }}*"}' \
            ${{ secrets.SLACK_WEBHOOK_URL }})
          # ë£¨íŠ¸ ë©”ì‹œì§€ timestamp ì¶”ì¶œ
          echo "ts=$(echo $RESPONSE | jq -r .ts)" >> $GITHUB_OUTPUT

      # ìŠ¤ë ˆë“œì— ì»¤ë°‹ ë©”ì‹œì§€ ë³´ë‚´ê¸°
      - name: Send commit details in thread
        run: |
          curl -X POST -H 'Content-type: application/json' \
          --data '{
            "text": "Commit: ${{ github.event.head_commit.message }}\nURL: ${{ github.event.head_commit.url }}",
            "thread_ts": "${{ steps.slack-root.outputs.ts }}"
          }' \
          ${{ secrets.SLACK_WEBHOOK_URL }}
